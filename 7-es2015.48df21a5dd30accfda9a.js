(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"2tF/":function(t,e,s){"use strict";var n=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}();e.AsyncAction=function(t){function e(e,s){var n=t.call(this,e,s)||this;return n.scheduler=e,n.work=s,n.pending=!1,n}return n(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var s=this.id,n=this.scheduler;return null!=s&&(this.id=this.recycleAsyncId(n,s,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,s){return void 0===s&&(s=0),setInterval(t.flush.bind(t,this),s)},e.prototype.recycleAsyncId=function(t,e,s){if(void 0===s&&(s=0),null!==s&&this.delay===s&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(t,e);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var s=!1,n=void 0;try{this.work(t)}catch(i){s=!0,n=!!i&&i||new Error(i)}if(s)return this.unsubscribe(),n},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,s=e.actions,n=s.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&s.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(s("Dz+M").Action)},"Dz+M":function(t,e,s){"use strict";var n=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}();e.Action=function(t){function e(e,s){return t.call(this)||this}return n(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(s("zB/H").Subscription)},GMZp:function(t,e,s){"use strict";e.isObject=function(t){return null!==t&&"object"==typeof t}},H0e8:function(t,e,s){"use strict";var n=s("O+eH");e.animationFrame=new(s("QY7M").AnimationFrameScheduler)(n.AnimationFrameAction)},LBXl:function(t,e,s){"use strict";e.UnsubscriptionError=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}()},NTcF:function(t,e,s){"use strict";var n=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}(),i=s("ffpz");e.AsyncScheduler=function(t){function e(s,n){void 0===n&&(n=i.Scheduler.now);var r=t.call(this,s,(function(){return e.delegate&&e.delegate!==r?e.delegate.now():n()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return n(e,t),e.prototype.schedule=function(s,n,i){return void 0===n&&(n=0),e.delegate&&e.delegate!==this?e.delegate.schedule(s,n,i):t.prototype.schedule.call(this,s,n,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var s;this.active=!0;do{if(s=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,s){for(;t=e.shift();)t.unsubscribe();throw s}}},e}(i.Scheduler)},"O+eH":function(t,e,s){"use strict";var n=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}();e.AnimationFrameAction=function(t){function e(e,s){var n=t.call(this,e,s)||this;return n.scheduler=e,n.work=s,n}return n(e,t),e.prototype.requestAsyncId=function(e,s,n){return void 0===n&&(n=0),null!==n&&n>0?t.prototype.requestAsyncId.call(this,e,s,n):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame((function(){return e.flush(null)}))))},e.prototype.recycleAsyncId=function(e,s,n){if(void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,s,n);0===e.actions.length&&(cancelAnimationFrame(s),e.scheduled=void 0)},e}(s("2tF/").AsyncAction)},QY7M:function(t,e,s){"use strict";var n=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}();e.AnimationFrameScheduler=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,s=this.actions,n=-1,i=s.length;t=t||s.shift();do{if(e=t.execute(t.state,t.delay))break}while(++n<i&&(t=s.shift()));if(this.active=!1,e){for(;++n<i&&(t=s.shift());)t.unsubscribe();throw e}},e}(s("NTcF").AsyncScheduler)},YanU:function(t,e,s){"use strict";s.r(e),s.d(e,"PostsModule",(function(){return k}));var n=s("ofXK"),i=s("PCNd"),r=s("tyNb"),o=s("lJxs"),c=s("pLZG"),u=s("3E0/"),a=s("H0e8"),h=s("fXoL"),p=s("2Vo4"),l=s("LvDl"),f=s("AytR");const d={isPostsLoading:!1,posts:{all:[],byId:{}}};var b=s("quSY");const y=new h.q("StreamSubscriptionToken");let v=(()=>{class t{constructor(t){this.token=t,this.subscriptions={},this.init=()=>{this.subscriptions[this.subToken]||(this.subscriptions[this.subToken]=new b.a)},this.add=t=>{this.init(),this.subscriptions[this.subToken].add(t)},this.unsubscribe=()=>{this.subscriptions[this.subToken]&&(this.subscriptions[this.subToken].unsubscribe(),this.subscriptions[this.subToken]=null)},this.execute=(t,e)=>{e&&e.pre&&e.pre(),this.add(t.subscribe(e))}}get subToken(){return this.token||t.defaultToken}}return t.defaultToken="SUBSCRIPTIONS",t.\u0275fac=function(e){return new(e||t)(h.Rb(y,8))},t.\u0275prov=h.Hb({token:t,factory:t.\u0275fac}),t})();var g=s("MWLU"),_=s("1Tb2");let m=(()=>{class t extends class{constructor(t){this.resetState=(t=this.initialState)=>{this.setState(t)},this.getState=()=>Object(l.mapValues)(this.innerState$,t=>t.getValue()),this.logPrevState=t=>{f.a.logState&&(console.groupCollapsed(`%c ${t} state changed`,"color: blue;"),console.log("%c prev state","color: red;",this.state))},this.logNextState=t=>{if(f.a.logState){const e=Object.keys(t).join(",");console.log("%c next state","color: green;",this.state),console.log("%c changed fields","color: blue;",e),console.groupEnd()}},this.innerState$=Object(l.mapValues)(t,t=>new p.a(t)),this.state$=Object(l.mapValues)(this.innerState$,t=>t.asObservable()),this.innerState=t,this.initialState=t}get state(){return this.innerState}setState(t){let e;e="function"==typeof t?t(this.state):t,this.logPrevState(this.constructor.name),Object.entries(e).forEach(([t,e])=>this.innerState$[t].next(e)),this.innerState=this.getState(),this.logNextState(e)}}{constructor(t,e,s){super(d),this.executions=t,this.dataNormalizer=e,this.postsApi=s,this.getPosts=()=>this.executions.execute(this.postsApi.getPosts({userId:8}),{pre:()=>{this.setState({isPostsLoading:!0})},next:t=>{const e=this.dataNormalizer.normalize(t);this.setState({isPostsLoading:!1,posts:e})}})}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(v),h.Rb(g.a),h.Rb(_.a))},t.\u0275prov=h.Hb({token:t,factory:t.\u0275fac}),t})();var O=s("2RwD");let w=(()=>{class t{constructor(){this.alt="An image"}get styleClasses(){return`lazy ${this.styleClass||""}`}get srcSet(){return`${this.srcPic} 1x, ${this.srcRetina} 2x`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h.Fb({type:t,selectors:[["app-image"]],inputs:{styleClass:"styleClass",alt:"alt",srcPic:"srcPic",srcRetina:"srcRetina",srcMock:"srcMock"},decls:1,vars:6,consts:[[3,"alt","src"]],template:function(t,e){1&t&&h.Mb(0,"img",0),2&t&&(h.Cb(e.styleClasses),h.cc("alt",e.alt)("src",e.srcMock,h.fc),h.Bb("data-src",e.srcPic)("data-srcset",e.srcSet))},styles:[".lazy[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),t})();function x(t,e){1&t&&(h.Ob(0,"div",3),h.ic(1," Loading posts... "),h.Nb())}const S=function(t){return["/posts",t]};function A(t,e){if(1&t&&(h.Ob(0,"div",4),h.Ob(1,"h3"),h.ic(2),h.Nb(),h.Ob(3,"p"),h.ic(4),h.Nb(),h.Ob(5,"a",5),h.ic(6,"View"),h.Nb(),h.Ob(7,"p"),h.ic(8),h.Nb(),h.Mb(9,"app-image",6),h.Nb()),2&t){const t=e.$implicit,s=h.Xb();h.Ab(2),h.jc(t.title),h.Ab(2),h.lc("Post #",t.id," by user #",t.userId,""),h.Ab(1),h.cc("routerLink",h.dc(8,S,t.id)),h.Ab(3),h.kc(" ",t.body," "),h.Ab(1),h.cc("srcMock","https://via.placeholder.com/2x1")("srcPic",s.getPostImage(t))("srcRetina",s.getPostImage(t))}}const P=[{path:"",component:(()=>{class t{constructor(t,e,s){this.postsService=t,this.lazyLoadService=e,this.executions=s,this.getPostImage=t=>`https://via.placeholder.com/1920x1080?text=${t.id}+${+new Date}`,this.isLoading$=this.postsService.state$.isPostsLoading,this.posts$=this.postsService.state$.posts.pipe(Object(o.a)(t=>t.all.map(e=>t.byId[e])))}ngOnInit(){this.executions.add(this.posts$.pipe(Object(c.a)(t=>!!t.length),Object(u.a)(0,a.animationFrame)).subscribe(()=>{this.lazyLoadService.update()})),this.postsService.getPosts()}ngOnDestroy(){this.executions.unsubscribe(),this.postsService.executions.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(h.Lb(m),h.Lb(O.a),h.Lb(v))},t.\u0275cmp=h.Fb({type:t,selectors:[["app-posts"]],decls:5,vars:6,consts:[[1,"posts"],["class","posts__loading",4,"ngIf"],["class","posts__card",4,"ngFor","ngForOf"],[1,"posts__loading"],[1,"posts__card"],[3,"routerLink"],[3,"srcMock","srcPic","srcRetina"]],template:function(t,e){1&t&&(h.Ob(0,"div",0),h.hc(1,x,2,0,"div",1),h.Yb(2,"async"),h.hc(3,A,10,10,"div",2),h.Yb(4,"async"),h.Nb()),2&t&&(h.Ab(1),h.cc("ngIf",h.Zb(2,2,e.isLoading$)),h.Ab(2),h.cc("ngForOf",h.Zb(4,4,e.posts$)))},directives:[n.j,n.i,r.e,w],pipes:[n.b],styles:[".posts[_ngcontent-%COMP%]{max-width:1024px;margin:0 auto;display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;padding:30px 0}.posts__card[_ngcontent-%COMP%]{width:calc((100% - 15px)/2);border:1px solid #ccc;border-radius:10px;padding:15px;box-sizing:border-box;margin-bottom:15px}.posts__card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-transform:uppercase}"],changeDetection:0}),t})()},{path:":slug",component:(()=>{class t{constructor(t){this.activatedRoute=t,this.postSlug$=this.activatedRoute.paramMap.pipe(Object(o.a)(t=>t.get("slug")))}}return t.\u0275fac=function(e){return new(e||t)(h.Lb(r.a))},t.\u0275cmp=h.Fb({type:t,selectors:[["app-post"]],decls:3,vars:3,consts:[[1,"post"]],template:function(t,e){1&t&&(h.Ob(0,"div",0),h.ic(1),h.Yb(2,"async"),h.Nb()),2&t&&(h.Ab(1),h.kc('I am post identified as "',h.Zb(2,1,e.postSlug$),'"'))},pipes:[n.b],styles:[".post[_ngcontent-%COMP%]{max-width:300px;padding:30px;border:1px solid #ccc;border-radius:5px;margin:45px auto}"],changeDetection:0}),t})()}];let k=(()=>{class t{}return t.\u0275mod=h.Jb({type:t}),t.\u0275inj=h.Ib({factory:function(e){return new(e||t)},providers:[m,v],imports:[[n.c,i.a,r.f.forChild(P)]]}),t})()},ffpz:function(t,e,s){"use strict";e.Scheduler=function(){function t(e,s){void 0===s&&(s=t.now),this.SchedulerAction=e,this.now=s}return t.prototype.schedule=function(t,e,s){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(s,e)},t.now=function(){return Date.now()},t}()},mbIT:function(t,e,s){"use strict";e.isArray=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}()},pshJ:function(t,e,s){"use strict";e.isFunction=function(t){return"function"==typeof t}},"zB/H":function(t,e,s){"use strict";var n=s("mbIT"),i=s("GMZp"),r=s("pshJ"),o=s("LBXl");function c(t){return t.reduce((function(t,e){return t.concat(e instanceof o.UnsubscriptionError?e.errors:e)}),[])}e.Subscription=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var s=this._parentOrParents,u=this._unsubscribe,a=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,s instanceof t)s.remove(this);else if(null!==s)for(var h=0;h<s.length;++h)s[h].remove(this);if(r.isFunction(u))try{u.call(this)}catch(f){e=f instanceof o.UnsubscriptionError?c(f.errors):[f]}if(n.isArray(a)){h=-1;for(var p=a.length;++h<p;){var l=a[h];if(i.isObject(l))try{l.unsubscribe()}catch(f){e=e||[],f instanceof o.UnsubscriptionError?e=e.concat(c(f.errors)):e.push(f)}}}if(e)throw new o.UnsubscriptionError(e)}},t.prototype.add=function(e){var s=e;if(!e)return t.EMPTY;switch(typeof e){case"function":s=new t(e);case"object":if(s===this||s.closed||"function"!=typeof s.unsubscribe)return s;if(this.closed)return s.unsubscribe(),s;if(!(s instanceof t)){var n=s;(s=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=s._parentOrParents;if(null===i)s._parentOrParents=this;else if(i instanceof t){if(i===this)return s;s._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return s;i.push(this)}var r=this._subscriptions;return null===r?this._subscriptions=[s]:r.push(s),s},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var s=e.indexOf(t);-1!==s&&e.splice(s,1)}},t.EMPTY=((e=new t).closed=!0,e),t}()}}]);